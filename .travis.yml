language: rust
sudo: required
services:
  - postgresql
cache:
  cargo: true
  directories:
    - frontend/elm-stuff
    - frontend/node_modules
rust:
  - nightly-2017-12-21
  - nightly
node_js:
  - "node"
git:
  depth: 5
branches:
  only:
    - master
matrix:
  allow_failures:
    - rust: nightly
env:
  global:
    - RUST_BACKTRACE=1
before_install:
  - nvm install 7.9.0
  - nvm use 7.9.0
before_script:
  - mv .travis.env .env
  - source .env
  - psql -c 'create database travis_ci_test;' -U postgres
  - cd frontend/ && npm run reinstall
  - cd ../
script:
  - cd frontend/
  - npm run build
  - cd ../
  - cargo build --verbose
  - cargo test --verbose -- --test-threads 1
